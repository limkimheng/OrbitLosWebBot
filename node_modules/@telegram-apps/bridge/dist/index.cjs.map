{"version":3,"file":"index.cjs","sources":["../../transformers/dist/index.js","../src/env/hasWebviewProxy.ts","../src/env/isIframe.ts","../../toolkit/dist/index.js","../../signals/dist/index.js","../src/debug.ts","../src/events/transformers.ts","../src/events/listening/lastEvent.ts","../src/events/listening/signalFor.ts","../src/events/listening/on.ts","../src/errors.ts","../src/methods/$targetOrigin.ts","../src/methods/postEvent.ts","../src/utils/request.ts","../src/launch-params/parseLaunchParams.ts","../src/launch-params/retrieveFromUrl.ts","../src/launch-params/retrieveFromLocation.ts","../src/launch-params/retrieveFromPerformance.ts","../src/launch-params/storage.ts","../src/launch-params/retrieveLaunchParams.ts","../src/env/isTMA.ts","../src/events/emitMiniAppsEvent.ts","../src/env/mockTelegramEnv.ts","../src/events/listening/defineEventHandlers.ts","../src/events/listening/removeEventHandlers.ts","../src/events/listening/off.ts","../src/events/listening/subscribe.ts","../src/events/listening/unsubscribe.ts","../src/methods/captureSameReq.ts","../src/utils/compareVersions.ts","../src/methods/supports.ts","../src/methods/createPostEvent.ts","../src/utils/invokeCustomMethod.ts","../src/resetPackageState.ts"],"sourcesContent":["class u extends Error {\n  constructor(e, r, n) {\n    super(\n      typeof r == \"object\" ? r.message : r || e,\n      {\n        cause: typeof r == \"object\" ? r.cause : n\n      }\n    ), this.type = e, Object.setPrototypeOf(this, u.prototype);\n  }\n}\nfunction h(t) {\n  return t.replace(/[A-Z]/g, (e) => `_${e.toLowerCase()}`);\n}\nfunction S(t) {\n  return t.replace(/_[a-z]/g, (e) => e[1].toUpperCase());\n}\nconst w = \"ERR_INVALID_VALUE\", D = \"ERR_UNEXPECTED_VALUE\", W = \"ERR_UNEXPECTED_TYPE\", d = \"ERR_PARSE\";\nfunction A(t, e) {\n  const r = {};\n  for (const n in t) {\n    const o = t[n];\n    if (!o)\n      continue;\n    let a, c;\n    typeof o == \"function\" ? (a = n, c = o) : [a, c] = o;\n    try {\n      const s = c(e(a));\n      s !== void 0 && (r[n] = s);\n    } catch (s) {\n      throw new u(\n        d,\n        `Parser for \"${n}\" property failed${a === n ? \"\" : `. Source field: \"${a}\"`}`,\n        s\n      );\n    }\n  }\n  return r;\n}\nfunction P(t) {\n  let e = t;\n  if (typeof e == \"string\")\n    try {\n      e = JSON.parse(e);\n    } catch (r) {\n      throw new u(w, { cause: r });\n    }\n  if (typeof e != \"object\" || !e || Array.isArray(e))\n    throw new u(D);\n  return e;\n}\nfunction i(t, e) {\n  return (r) => {\n    const n = (o) => {\n      if (!(r && o === void 0))\n        try {\n          return e(o);\n        } catch (a) {\n          throw new u(d, {\n            message: `\"${t}\" transformer failed to parse the value`,\n            cause: a\n          });\n        }\n    };\n    return /* @__PURE__ */ Object.assign(\n      n,\n      {\n        isValid(o) {\n          try {\n            return n(o), !0;\n          } catch {\n            return !1;\n          }\n        }\n      }\n    );\n  };\n}\nfunction m(t, e) {\n  return i(e || \"object\", (r) => {\n    const n = P(r);\n    return A(t, (o) => n[o]);\n  });\n}\nfunction p(t) {\n  throw new u(W, `Unexpected value received: ${JSON.stringify(t)}`);\n}\nconst E = i(\"boolean\", (t) => {\n  if (typeof t == \"boolean\")\n    return t;\n  const e = String(t);\n  if (e === \"1\" || e === \"true\")\n    return !0;\n  if (e === \"0\" || e === \"false\")\n    return !1;\n  p(t);\n}), f = i(\"string\", (t) => {\n  if (typeof t == \"string\" || typeof t == \"number\")\n    return t.toString();\n  p(t);\n}), g = i(\"number\", (t) => {\n  if (typeof t == \"number\")\n    return t;\n  if (typeof t == \"string\") {\n    const e = Number(t);\n    if (!Number.isNaN(e))\n      return e;\n  }\n  p(t);\n}), U = i(\"date\", (t) => t instanceof Date ? t : new Date(g()(t) * 1e3));\nfunction R(t, e) {\n  return i(e || \"searchParams\", (r) => {\n    typeof r != \"string\" && !(r instanceof URLSearchParams) && p(r);\n    const n = typeof r == \"string\" ? new URLSearchParams(r) : r;\n    return A(t, (o) => {\n      const a = n.get(o);\n      return a === null ? void 0 : a;\n    });\n  });\n}\nfunction l(t) {\n  for (const e in t)\n    t[e] = [h(e), t[e]];\n  return t;\n}\nconst N = (t) => {\n  const e = g(), r = g(!0), n = f(), o = f(!0), a = E(!0), c = m(l({\n    addedToAttachmentMenu: a,\n    allowsWriteToPm: a,\n    firstName: n,\n    id: e,\n    isBot: a,\n    isPremium: a,\n    languageCode: o,\n    lastName: o,\n    photoUrl: o,\n    username: o\n  }), \"User\")(!0);\n  return R(\n    l({\n      authDate: U(),\n      canSendAfter: r,\n      chat: m(\n        l({\n          id: e,\n          type: n,\n          title: n,\n          photoUrl: o,\n          username: o\n        }),\n        \"Chat\"\n      )(!0),\n      chatInstance: o,\n      chatType: o,\n      hash: n,\n      queryId: o,\n      receiver: c,\n      startParam: o,\n      signature: n,\n      user: c\n    }),\n    \"initData\"\n  )(t);\n};\nfunction O(t) {\n  return /^#[\\da-f]{6}$/i.test(t);\n}\nfunction _(t) {\n  return /^#[\\da-f]{3}$/i.test(t);\n}\nfunction C(t) {\n  const e = t.replace(/\\s/g, \"\").toLowerCase();\n  if (O(e))\n    return e;\n  if (_(e)) {\n    let n = \"#\";\n    for (let o = 0; o < 3; o += 1)\n      n += e[1 + o].repeat(2);\n    return n;\n  }\n  const r = e.match(/^rgb\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)$/) || e.match(/^rgba\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),\\d{1,3}\\)$/);\n  if (!r)\n    throw new Error(`Value \"${t}\" does not satisfy any of known RGB formats.`);\n  return r.slice(1).reduce((n, o) => {\n    const a = parseInt(o, 10).toString(16);\n    return n + (a.length === 1 ? \"0\" : \"\") + a;\n  }, \"#\");\n}\nconst T = i(\"rgb\", (t) => C(f()(t))), b = i(\n  \"themeParams\",\n  (t) => {\n    const e = T(!0);\n    return Object.entries(P(t)).reduce((r, [n, o]) => (r[S(n)] = e(o), r), {});\n  }\n);\n// @__NO_SIDE_EFFECTS__\nfunction y(t) {\n  return JSON.stringify(\n    Object.fromEntries(\n      Object.entries(t).map(([e, r]) => [h(e), r])\n    )\n  );\n}\nconst V = (t) => {\n  const e = f(), r = f(!0), n = E(!0);\n  return R({\n    botInline: [\"tgWebAppBotInline\", n],\n    defaultColors: [\"tgWebAppDefaultColors\", b(!0)],\n    fullscreen: [\"tgWebAppFullscreen\", n],\n    initData: [\"tgWebAppData\", N(!0)],\n    initDataRaw: [\"tgWebAppData\", r],\n    platform: [\"tgWebAppPlatform\", e],\n    showSettings: [\"tgWebAppShowSettings\", n],\n    startParam: [\"tgWebAppStartParam\", r],\n    themeParams: [\"tgWebAppThemeParams\", b()],\n    version: [\"tgWebAppVersion\", e]\n  }, \"launchParams\")(t);\n};\n// @__NO_SIDE_EFFECTS__\nfunction $(t) {\n  const {\n    initDataRaw: e,\n    startParam: r,\n    showSettings: n,\n    botInline: o,\n    fullscreen: a,\n    defaultColors: c\n  } = t, s = new URLSearchParams();\n  return s.set(\"tgWebAppPlatform\", t.platform), s.set(\"tgWebAppThemeParams\", /* @__PURE__ */ y(t.themeParams)), s.set(\"tgWebAppVersion\", t.version), e && s.set(\"tgWebAppData\", e), r && s.set(\"tgWebAppStartParam\", r), typeof n == \"boolean\" && s.set(\"tgWebAppShowSettings\", n ? \"1\" : \"0\"), typeof o == \"boolean\" && s.set(\"tgWebAppBotInline\", o ? \"1\" : \"0\"), typeof a == \"boolean\" && s.set(\"tgWebAppFullscreen\", a ? \"1\" : \"0\"), c && s.set(\"tgWebAppDefaultColors\", /* @__PURE__ */ y(c)), s.toString();\n}\nconst j = m({\n  eventType: f(),\n  eventData: (t) => t\n}, \"miniAppsMessage\");\nfunction L(t, e) {\n  return i(e || \"array\", (r) => {\n    let n;\n    if (Array.isArray(r))\n      n = r;\n    else if (typeof r == \"string\")\n      try {\n        const o = JSON.parse(r);\n        Array.isArray(o) && (n = o);\n      } catch {\n      }\n    return n || p(r), n.map(t);\n  });\n}\nconst I = i(\"fn\", (t) => {\n  if (typeof t == \"function\")\n    return t;\n  p(t);\n});\nfunction B(t) {\n  return !!t && typeof t == \"object\" && !Array.isArray(t);\n}\nexport {\n  w as ERR_INVALID_VALUE,\n  d as ERR_PARSE,\n  W as ERR_UNEXPECTED_TYPE,\n  D as ERR_UNEXPECTED_VALUE,\n  L as array,\n  E as boolean,\n  i as createTransformerGen,\n  U as date,\n  I as fn,\n  N as initData,\n  O as isRGB,\n  _ as isRGBShort,\n  B as isRecord,\n  V as launchParams,\n  j as miniAppsMessage,\n  g as number,\n  m as object,\n  T as rgb,\n  R as searchParams,\n  $ as serializeLaunchParams,\n  y as serializeThemeParams,\n  f as string,\n  b as themeParams,\n  C as toRGB,\n  P as toRecord\n};\n//# sourceMappingURL=index.js.map\n","import { object, fn } from '@telegram-apps/transformers';\n\ninterface WithWebviewProxy {\n  TelegramWebviewProxy: {\n    postEvent: (...args: unknown[]) => unknown;\n  };\n}\n\nconst webViewProxy = object<WithWebviewProxy>({\n  TelegramWebviewProxy: object({ postEvent: fn() })(),\n});\n\n/**\n * Returns true in case, passed value contains path `TelegramWebviewProxy.postEvent` property and\n * `postEvent` is a function.\n * @param value - value to check.\n */\nexport function hasWebviewProxy<T>(value: T): value is T & WithWebviewProxy {\n  return webViewProxy().isValid(value);\n}\n","/**\n * @see https://stackoverflow.com/a/326076\n * @returns True, if current environment is iframe.\n */\nexport function isIframe(): boolean {\n  try {\n    return window.self !== window.top;\n  } catch {\n    return true;\n  }\n}\n","var k = Object.defineProperty;\nvar I = (r, e, t) => e in r ? k(r, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) : r[e] = t;\nvar E = (r, e, t) => I(r, typeof e != \"symbol\" ? e + \"\" : e, t);\nclass d extends Error {\n  constructor(e, t, n) {\n    super(\n      typeof t == \"object\" ? t.message : t || e,\n      {\n        cause: typeof t == \"object\" ? t.cause : n\n      }\n    ), this.type = e, Object.setPrototypeOf(this, d.prototype);\n  }\n}\nfunction x(r, e, t) {\n  return r.addEventListener(e, t), () => r.removeEventListener(e, t);\n}\nfunction _(...r) {\n  const e = r.flat(1);\n  return [\n    e.push.bind(e),\n    () => {\n      e.forEach((t) => {\n        t();\n      });\n    }\n  ];\n}\nfunction F(r, e) {\n  return r instanceof d && r.type === e;\n}\nfunction m(r) {\n  return (e) => F(e, r);\n}\nconst R = \"ERR_ABORTED\", $ = \"ERR_CANCELED\", S = \"ERR_TIMED_OUT\";\nfunction C(r) {\n  return new d(R, { cause: r });\n}\nconst U = m(S), V = m(R), B = m($);\nfunction T(r, e) {\n  return r.reject = e.reject, r;\n}\nclass i extends Promise {\n  constructor(t, n) {\n    let o, s;\n    typeof t == \"function\" ? (o = t, s = n) : s = t;\n    let u, c;\n    super((a, h) => {\n      s || (s = {});\n      const { abortSignal: l } = s;\n      if (l && l.aborted)\n        return h(C(l.reason));\n      const [y, A] = _(), b = (f) => (...L) => (A(), f(...L)), w = new AbortController(), { signal: D } = w;\n      c = b((f) => {\n        w.abort(f), h(f);\n      }), u = b(a), l && y(\n        x(l, \"abort\", () => {\n          c(C(l.reason));\n        })\n      );\n      const { timeout: g } = s;\n      if (g) {\n        const f = setTimeout(() => {\n          c(new d(S, `Timeout reached: ${g}ms`));\n        }, g);\n        y(() => {\n          clearTimeout(f);\n        });\n      }\n      o && o(u, c, D);\n    });\n    /**\n     * Rejects the promise.\n     */\n    E(this, \"reject\");\n    this.reject = c;\n  }\n  /**\n   * Creates a new BetterPromise instance using executor, resolving promise when a result\n   * was returned.\n   * @param fn - function returning promise result.\n   * @param options - additional options.\n   */\n  static withFn(t, n) {\n    return new i((o, s, u) => {\n      try {\n        const c = t(u);\n        return c instanceof Promise ? c.then(o, s) : o(c);\n      } catch (c) {\n        s(c);\n      }\n    }, n);\n  }\n  /**\n   * @see Promise.resolve\n   */\n  static resolve(t) {\n    return new i((n) => {\n      n(t);\n    });\n  }\n  /**\n   * @see Promise.reject\n   */\n  static reject(t) {\n    return new i((n, o) => {\n      o(t);\n    });\n  }\n  /**\n   * Cancels the promise execution.\n   */\n  cancel() {\n    this.reject(new d($));\n  }\n  /**\n   * @see Promise.catch\n   */\n  catch(t) {\n    return this.then(void 0, t);\n  }\n  /**\n   * @see Promise.finally\n   */\n  finally(t) {\n    return T(super.finally(t), this);\n  }\n  /**\n   * @see Promise.then\n   */\n  then(t, n) {\n    return T(super.then(t, n), this);\n  }\n}\nfunction v(r, e) {\n  return r.resolve = e.resolve, r;\n}\nclass p extends i {\n  constructor(t, n) {\n    let o, s;\n    typeof t == \"function\" ? (o = t, s = n) : s = t;\n    let u;\n    super((c, a, h) => {\n      u = c, o && o(c, a, h);\n    }, s);\n    /**\n     * Resolves the promise.\n     */\n    E(this, \"resolve\");\n    this.resolve = u;\n  }\n  /**\n   * Creates a new EnhancedPromise instance using executor, resolving promise when a result\n   * was returned.\n   * @param fn - function returning promise result.\n   * @param options - additional options.\n   */\n  static withFn(t, n) {\n    return new p(\n      (o, s, u) => i.withFn(t, { abortSignal: u }).then(o, s),\n      n\n    );\n  }\n  /**\n   * @see Promise.resolve\n   */\n  static resolve(t) {\n    return new p((n) => {\n      n(t);\n    });\n  }\n  /**\n   * @see Promise.reject\n   */\n  static reject(t) {\n    return new p((n, o) => {\n      o(t);\n    });\n  }\n  /**\n   * @see Promise.catch\n   */\n  catch(t) {\n    return this.then(void 0, t);\n  }\n  /**\n   * @see Promise.finally\n   */\n  finally(t) {\n    return v(super.finally(t), this);\n  }\n  /**\n   * @see Promise.then\n   */\n  then(t, n) {\n    return v(super.then(t, n), this);\n  }\n}\nfunction Z(r, e) {\n  return new i((t) => {\n    setTimeout(t, r);\n  }, { abortSignal: e });\n}\nfunction j(r) {\n  return `tapps/${r}`;\n}\nfunction J(r, e) {\n  sessionStorage.setItem(j(r), JSON.stringify(e));\n}\nfunction K(r) {\n  const e = sessionStorage.getItem(j(r));\n  try {\n    return e ? JSON.parse(e) : void 0;\n  } catch {\n  }\n}\nfunction M(r) {\n  return r.replace(/[A-Z]/g, (e) => `-${e.toLowerCase()}`);\n}\nfunction z(r) {\n  return r.replace(/[A-Z]/g, (e) => `_${e.toLowerCase()}`);\n}\nfunction G(r) {\n  return r.replace(/_[a-z]/g, (e) => e[1].toUpperCase());\n}\n// @__NO_SIDE_EFFECTS__\nfunction q(r, e) {\n  e || (e = {});\n  const {\n    textColor: t,\n    bgColor: n,\n    shouldLog: o = !0\n  } = e;\n  function s(u, ...c) {\n    if (!o || typeof o == \"function\" && !o())\n      return;\n    const a = \"font-weight:bold;padding:0 5px;border-radius:5px\";\n    console[u](\n      `%c${Intl.DateTimeFormat(\"en-GB\", {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\",\n        fractionalSecondDigits: 3,\n        timeZone: \"UTC\"\n      }).format(/* @__PURE__ */ new Date())}%c / %c${r}`,\n      `${a};background-color: lightblue;color:black`,\n      \"\",\n      `${a};${t ? `color:${t};` : \"\"}${n ? `background-color:${n}` : \"\"}`,\n      ...c\n    );\n  }\n  return [\n    function(...c) {\n      s(\"log\", ...c);\n    },\n    function(...c) {\n      s(\"error\", ...c);\n    }\n  ];\n}\nfunction H(r, e) {\n  document.documentElement.style.setProperty(r, e);\n}\nfunction P(r) {\n  document.documentElement.style.removeProperty(r);\n}\nexport {\n  i as CancelablePromise,\n  R as ERR_ABORTED,\n  $ as ERR_CANCELED,\n  S as ERR_TIMED_OUT,\n  p as EnhancedPromise,\n  d as TypedError,\n  x as addEventListener,\n  M as camelToKebab,\n  z as camelToSnake,\n  C as createAbortError,\n  _ as createCbCollector,\n  q as createLogger,\n  m as createTypedErrorPredicate,\n  P as deleteCssVar,\n  K as getStorageValue,\n  V as isAbortError,\n  B as isCanceledError,\n  F as isErrorOfType,\n  U as isTimeoutError,\n  H as setCssVar,\n  J as setStorageValue,\n  Z as sleep,\n  G as snakeToCamel\n};\n//# sourceMappingURL=index.js.map\n","let r;\nfunction y(e, c) {\n  r && r.set(e, c) || c();\n}\nfunction m(e) {\n  if (r)\n    return e();\n  r = /* @__PURE__ */ new Map();\n  try {\n    e();\n  } finally {\n    r.forEach((c) => c()), r = void 0;\n  }\n}\n// @__NO_SIDE_EFFECTS__\nfunction S(e, c) {\n  c || (c = {});\n  const g = c.equals || Object.is;\n  let u = [], s = e;\n  const i = (t) => {\n    if (!g(s, t)) {\n      const l = s;\n      s = t, y(o, () => {\n        [...u].forEach(([f, d]) => {\n          f(t, l), d && n(f, !0);\n        });\n      });\n    }\n  };\n  function a(t) {\n    const l = typeof t != \"object\" ? { once: t } : t;\n    return {\n      once: l.once || !1,\n      signal: l.signal || !1\n    };\n  }\n  const n = (t, l) => {\n    const f = a(l), d = u.findIndex(([h, p]) => h === t && p.once === f.once && p.signal === f.signal);\n    d >= 0 && u.splice(d, 1);\n  }, o = Object.assign(\n    function() {\n      return j(o), s;\n    },\n    {\n      destroy() {\n        u = [];\n      },\n      set: i,\n      reset() {\n        i(e);\n      },\n      sub(t, l) {\n        return u.push([t, a(l)]), () => n(t, l);\n      },\n      unsub: n,\n      unsubAll() {\n        u = u.filter((t) => t[1].signal);\n      }\n    }\n  );\n  return o;\n}\nconst b = [];\nfunction j(e) {\n  b.length && b[b.length - 1].add(e);\n}\n// @__NO_SIDE_EFFECTS__\nfunction x(e, c) {\n  let g = /* @__PURE__ */ new Set(), u;\n  function s() {\n    return u || (u = /* @__PURE__ */ S(a(), c));\n  }\n  function i() {\n    s().set(a());\n  }\n  function a() {\n    g.forEach((t) => {\n      t.unsub(i, { signal: !0 });\n    });\n    const n = /* @__PURE__ */ new Set();\n    let o;\n    b.push(n);\n    try {\n      o = e();\n    } finally {\n      b.pop();\n    }\n    return n.forEach((t) => {\n      t.sub(i, { signal: !0 });\n    }), g = n, o;\n  }\n  return Object.assign(function() {\n    return s()();\n  }, {\n    destroy() {\n      s().destroy();\n    },\n    sub(...n) {\n      return s().sub(...n);\n    },\n    unsub(...n) {\n      s().unsub(...n);\n    },\n    unsubAll(...n) {\n      s().unsubAll(...n);\n    }\n  });\n}\nexport {\n  m as batch,\n  x as computed,\n  S as signal\n};\n//# sourceMappingURL=index.js.map\n","import { signal } from '@telegram-apps/signals';\nimport { createLogger } from '@telegram-apps/toolkit';\n\n/**\n * The package debug mode.\n *\n * Enabling debug mode leads to printing additional messages in the console related to the\n * processes inside the package.\n */\nexport const $debug = signal(false);\n\nexport const [logInfo, logError] = createLogger('Bridge', {\n  bgColor: '#9147ff',\n  textColor: 'white',\n  shouldLog: $debug,\n});\n","import {\n  boolean,\n  createTransformerGen,\n  number,\n  object,\n  string,\n  type TransformerGen,\n} from '@telegram-apps/transformers';\n\nimport type { EventName, EventPayload } from '@/events/types/events.js';\n\n/**\n * Transformers for problematic Mini Apps events.\n */\nexport const transformers: { [E in EventName]?: TransformerGen<EventPayload<E>> } = {\n  clipboard_text_received: object({\n    req_id: string(),\n    data: (value) => (value === null ? value : string(true)(value)),\n  }, 'clipboard_text_received'),\n  custom_method_invoked: object({\n    req_id: string(),\n    result: (value) => value,\n    error: string(true),\n  }, 'custom_method_invoked'),\n  popup_closed: createTransformerGen('popup_closed', value => {\n    return value\n      ? object({\n        button_id: (value) => (\n          value === null || value === undefined ? undefined : string()(value)\n        ),\n      })()(value)\n      : {};\n  }),\n  viewport_changed: object({\n    height: number(),\n    width: (value) => (\n      value === null || value === undefined\n        ? window.innerWidth\n        : number()(value)\n    ),\n    is_state_stable: boolean(),\n    is_expanded: boolean(),\n  }, 'viewport_changed'),\n};","import { createCbCollector, addEventListener, type If, type IsNever } from '@telegram-apps/toolkit';\nimport { Signal, signal } from '@telegram-apps/signals';\nimport { miniAppsMessage, type MiniAppsMessage } from '@telegram-apps/transformers';\n\nimport { logError, logInfo } from '@/debug.js';\n\nimport { transformers } from '../transformers.js';\nimport type { EventPayload, EventName } from '../types/events.js';\n\nexport type LastEvent = {\n  [E in EventName]: [E, If<IsNever<EventPayload<E>>, undefined, EventPayload<E>>]\n}[EventName];\n\n/**\n * Creates window event listeners, tracking Mini Apps events and calling passed handler with their\n * data.\n * @param onEvent - event callback.\n */\nfunction defineListeners(onEvent: (event: LastEvent) => void): () => void {\n  const w = window;\n  const [, cleanup] = createCbCollector(\n    // Add listener, which handles events sent from the Telegram web application and also events\n    // generated by the local emitEvent function.\n    addEventListener(w, 'message', (event) => {\n      // Ignore non-parent window messages.\n      if (event.source !== w.parent) {\n        return;\n      }\n\n      // Parse incoming event data.\n      let message: MiniAppsMessage;\n      try {\n        message = miniAppsMessage()(event.data);\n      } catch {\n        // We ignore incorrect messages as they could be generated by any other code.\n        return;\n      }\n\n      const { eventType, eventData } = message;\n      const createTransformer = transformers[eventType as keyof typeof transformers];\n\n      try {\n        const transformed = createTransformer\n          ? createTransformer()(eventData)\n          : eventData;\n        logInfo('Event received:', transformed\n          ? { eventType, eventData: transformed }\n          : { eventType });\n        onEvent([eventType, transformed] as LastEvent);\n      } catch (cause) {\n        logError(\n          [\n            `An error occurred processing the \"${eventType}\" event from the Telegram application.`,\n            'Please, file an issue here:',\n            'https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose',\n          ].join('\\n'),\n          message,\n          cause,\n        );\n      }\n    }),\n  );\n\n  return cleanup;\n}\n\n/**\n * Last received event.\n */\nexport const $lastEvent = signal<LastEvent>();\n\n/**\n * Side effects listening cleanup function. It will be eventually set when some code tried\n * to retrieve the last event.\n */\nexport const $lastEventCleanup = signal<() => void>();\n\n/**\n * Retrieve last received Mini Apps event ensuring that external listeners were defined.\n */\nexport function lastEventSignal(): Signal<LastEvent | undefined> {\n  if (!$lastEventCleanup()) {\n    $lastEventCleanup.set(defineListeners($lastEvent.set));\n  }\n  return $lastEvent;\n}\n\n","import { type Signal, signal } from '@telegram-apps/signals';\n\nimport { lastEventSignal } from '@/events/listening/lastEvent.js';\nimport type { EventName } from '@/events/types/events.js';\nimport type { SignalPayload } from '@/events/listening/types.js';\n\ntype CachedSignal<E extends EventName> = Signal<SignalPayload<E>>;\ntype Cache = {\n  [E in EventName]?: CachedSignal<E>\n};\n\nexport const $eventSignalsCache = signal<Cache>({});\n\n/**\n * Returns a signal for specified event using cache.\n * @param event - event name.\n */\nexport function signalFor<E extends EventName>(event: E): CachedSignal<E> {\n  let cached = $eventSignalsCache()[event];\n  if (!cached) {\n    // This is the special symbol we use to notify signal, that nothing changed, and the current\n    // value should be preserved.\n    cached = signal(undefined, {\n      equals() {\n        // We may receive several undefined in a row. For example,\n        // in the main_button_pressed event.\n        return false;\n      },\n    }) as Cache[E];\n    lastEventSignal().sub(ev => {\n      if (ev && ev[0] === event) {\n        cached!.set(ev[1] as SignalPayload<E>);\n      }\n    });\n\n    $eventSignalsCache.set({ ...$eventSignalsCache(), [event]: cached });\n  }\n\n  return cached as CachedSignal<E>;\n}","import type { RemoveListenerFn } from '@telegram-apps/signals';\n\nimport { signalFor } from '@/events/listening/signalFor.js';\nimport type { EventName } from '@/events/types/events.js';\nimport type { EventListener } from '@/events/listening/types.js';\n\n/**\n * Adds a new listener to the specified event.\n * @param event - event name.\n * @param listener - event listener.\n * @param once - should listener be called only once.\n * @returns Function to remove bound event listener.\n */\nexport function on<E extends EventName>(\n  event: E,\n  listener: EventListener<E>,\n  once?: boolean,\n): RemoveListenerFn {\n  return signalFor(event).sub(listener, once);\n}","export const ERR_METHOD_UNSUPPORTED = 'ERR_METHOD_UNSUPPORTED';\nexport const ERR_RETRIEVE_LP_FAILED = 'ERR_RETRIEVE_LP_FAILED';\nexport const ERR_METHOD_PARAMETER_UNSUPPORTED = 'ERR_METHOD_PARAMETER_UNSUPPORTED';\nexport const ERR_UNKNOWN_ENV = 'ERR_UNKNOWN_ENV';\nexport const ERR_CUSTOM_METHOD_ERR_RESPONSE = 'ERR_INVOKE_CUSTOM_METHOD_RESPONSE';\n","import { signal } from '@telegram-apps/signals';\n\n/**\n * Target origin used by the `postEvent` method.\n *\n * You don't need to override this value until you know what you are doing.\n * @default 'https://web.telegram.org'\n */\nexport const $targetOrigin = signal('https://web.telegram.org');\n","import { fn, object } from '@telegram-apps/transformers';\nimport { TypedError } from '@telegram-apps/toolkit';\n\nimport { logInfo } from '@/debug.js';\nimport { isIframe } from '@/env/isIframe.js';\nimport { hasWebviewProxy } from '@/env/hasWebviewProxy.js';\nimport { ERR_UNKNOWN_ENV } from '@/errors.js';\nimport { $targetOrigin } from '@/methods/$targetOrigin.js';\nimport type {\n  MethodName,\n  MethodNameWithOptionalParams,\n  MethodNameWithoutParams,\n  MethodNameWithRequiredParams,\n  MethodParams,\n} from '@/methods/types/index.js';\n\nexport type PostEventFn = typeof postEvent;\n\n/**\n * Calls Mini Apps methods requiring parameters.\n * @param method - method name.\n * @param params - options along with params.\n * @throws {TypedError} ERR_UNKNOWN_ENV\n */\nexport function postEvent<Method extends MethodNameWithRequiredParams>(\n  method: Method,\n  params: MethodParams<Method>,\n): void;\n\n/**\n * Calls Mini Apps methods accepting no parameters at all.\n * @param method - method name.\n * @throws {TypedError} ERR_UNKNOWN_ENV\n */\nexport function postEvent(method: MethodNameWithoutParams): void;\n\n/**\n * Calls Mini Apps methods accepting optional parameters.\n * @param method - method name.\n * @param params - options along with params.\n * @throws {TypedError} ERR_UNKNOWN_ENV\n */\nexport function postEvent<Method extends MethodNameWithOptionalParams>(\n  method: Method,\n  params?: MethodParams<Method>,\n): void;\n\nexport function postEvent(\n  eventType: MethodName,\n  eventData?: MethodParams<MethodName>,\n): void {\n  logInfo('Posting event:', eventData ? { eventType, eventData } : { eventType });\n\n  const w = window;\n\n  // Telegram for iOS and macOS.\n  if (hasWebviewProxy(w)) {\n    w.TelegramWebviewProxy.postEvent(eventType, JSON.stringify(eventData));\n    return;\n  }\n\n  const message = JSON.stringify({ eventType, eventData });\n\n  // Telegram Web.\n  if (isIframe()) {\n    return w.parent.postMessage(message, $targetOrigin());\n  }\n\n  // Telegram for Windows Phone or Android.\n  const { external } = w;\n  if (object({ notify: fn() })().isValid(external)) {\n    external.notify(message);\n    return;\n  }\n\n  // Otherwise current environment is unknown, and we are not able to send event.\n  throw new TypedError(ERR_UNKNOWN_ENV);\n}\n","import {\n  CancelablePromise,\n  createCbCollector,\n  type If,\n  type IsNever,\n} from '@telegram-apps/toolkit';\n\nimport { on } from '@/events/listening/on.js';\nimport { postEvent } from '@/methods/postEvent.js';\nimport type {\n  MethodName,\n  MethodNameWithOptionalParams,\n  MethodNameWithoutParams,\n  MethodNameWithRequiredParams,\n  MethodParams,\n} from '@/methods/types/index.js';\nimport type { EventName, EventPayload } from '@/events/types/events.js';\nimport type { ExecuteWithOptions } from '@/types.js';\n\ntype AnyEventName = EventName | EventName[];\n\nexport type RequestCaptureFnEventsPayload<E extends EventName[]> = E extends (infer U extends EventName)[]\n  ? {\n    [K in U]: If<\n      IsNever<EventPayload<K>>,\n      { event: K },\n      { event: K; payload: EventPayload<K> }\n    >\n  }[U]\n  : never;\n\nexport type RequestCaptureEventsFn<E extends EventName[]> = (\n  payload: RequestCaptureFnEventsPayload<E>,\n) => boolean\n\nexport type RequestCaptureEventFn<E extends EventName> = If<\n  IsNever<EventPayload<E>>,\n  () => boolean,\n  (payload: EventPayload<E>) => boolean\n>;\n\nexport type RequestCaptureFn<E extends AnyEventName> = E extends EventName[]\n  ? RequestCaptureEventsFn<E>\n  : E extends EventName\n    ? RequestCaptureEventFn<E>\n    : never;\n\nexport interface RequestBasicOptions<E extends AnyEventName> extends ExecuteWithOptions {\n  /**\n   * Should return true if this event should be captured.\n   * The first compatible request will be captured if this property is omitted.\n   */\n  capture?: RequestCaptureFn<E>;\n}\n\nexport type RequestResult<E extends AnyEventName> =\n  E extends (infer U extends EventName)[]\n    ? U extends infer K extends EventName\n      ? If<IsNever<EventPayload<K>>, undefined, EventPayload<K>>\n      : never\n    : E extends EventName\n      ? If<IsNever<EventPayload<E>>, undefined, EventPayload<E>>\n      : never;\n\nexport type RequestFn = typeof request;\n\n/**\n * Performs a request waiting for specified events to occur.\n *\n * This overriding is used for methods, requiring parameters.\n * @param method - method name.\n * @param eventOrEvents - tracked event or events.\n * @param options - additional options.\n */\nexport function request<M extends MethodNameWithRequiredParams, E extends AnyEventName>(\n  method: M,\n  eventOrEvents: E,\n  options: RequestBasicOptions<E> & { params: MethodParams<M> },\n): CancelablePromise<RequestResult<E>>;\n\n/**\n * Performs a request waiting for specified events to occur.\n *\n * This overriding is used for methods with optional parameters.\n * @param method - method name.\n * @param eventOrEvents - tracked event or events.\n * @param options - additional options.\n */\nexport function request<M extends MethodNameWithOptionalParams, E extends AnyEventName>(\n  method: M,\n  eventOrEvents: E,\n  options?: RequestBasicOptions<E> & { params?: MethodParams<M> },\n): CancelablePromise<RequestResult<E>>;\n\n/**\n * Performs a request waiting for specified events to occur.\n *\n * This overriding is used for methods without parameters.\n * @param method - method name.\n * @param eventOrEvents - tracked event or events.\n * @param options - additional options.\n */\nexport function request<M extends MethodNameWithoutParams, E extends AnyEventName>(\n  method: M,\n  eventOrEvents: E,\n  options?: RequestBasicOptions<E>,\n): CancelablePromise<RequestResult<E>>;\n\nexport function request<M extends MethodName, E extends AnyEventName>(\n  method: M,\n  eventOrEvents: E,\n  options?: RequestBasicOptions<E> & { params?: MethodParams<M> },\n): CancelablePromise<RequestResult<E>> {\n  options ||= {};\n  const { capture } = options;\n  const [addCleanup, cleanup] = createCbCollector();\n\n  return new CancelablePromise<RequestResult<E>>((resolve) => {\n    // We need to iterate over all tracked events and create their event listeners.\n    ((Array.isArray(eventOrEvents) ? eventOrEvents : [eventOrEvents])).forEach(event => {\n      // Each event listener waits for the event to occur.\n      // Then, if the capture function was passed, we should check if the event should be captured.\n      // If the function is omitted, we instantly capture the event.\n      addCleanup(\n        on(event, payload => {\n          if (!capture || (\n            Array.isArray(eventOrEvents)\n              ? (capture as RequestCaptureEventsFn<EventName[]>)({\n                event,\n                payload,\n              } as RequestCaptureFnEventsPayload<EventName[]>)\n              : (capture as RequestCaptureEventFn<EventName>)(payload)\n          )) {\n            resolve(payload as RequestResult<E>);\n          }\n        }),\n      );\n    });\n\n    (options.postEvent || postEvent)(method as any, (options as any).params);\n  }, options)\n    .finally(cleanup);\n}\n","import { launchParams, type LaunchParams } from '@telegram-apps/transformers';\n\n/**\n * Parses value as launch parameters.\n * @param value - value to parse.\n */\nexport function parseLaunchParams(value: unknown): LaunchParams {\n  return launchParams()(value);\n}\n","import type { LaunchParams } from '@telegram-apps/types';\n\nimport { parseLaunchParams } from './parseLaunchParams.js';\n\n/**\n * @param urlString - URL to extract launch parameters from.\n * @returns Launch parameters from the specified URL.\n * @throws Error if function was unable to extract launch parameters from the passed URL.\n */\nexport function retrieveFromUrl(urlString: string): LaunchParams {\n  return parseLaunchParams(\n    urlString\n      // Replace everything before this first hashtag or question sign.\n      .replace(/^[^?#]*[?#]/, '')\n      // Replace all hashtags and question signs to make it look like some search params.\n      .replace(/[?#]/g, '&'),\n  );\n}\n","import type { LaunchParams } from '@telegram-apps/types';\n\nimport { retrieveFromUrl } from './retrieveFromUrl.js';\n\n/**\n * @returns Launch parameters from the current window location hash.\n * @throws Error if function was unable to extract launch parameters from the window location hash.\n */\nexport function retrieveFromLocation(): LaunchParams {\n  return retrieveFromUrl(window.location.href);\n}\n","import type { LaunchParams } from '@telegram-apps/types';\n\nimport { retrieveFromUrl } from './retrieveFromUrl.js';\n\n/**\n * @returns Launch parameters based on the first navigation entry.\n * @throws Error if function was unable to extract launch parameters from the navigation entry.\n */\nexport function retrieveFromPerformance(): LaunchParams {\n  const navigationEntry = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming | undefined;\n  if (!navigationEntry) {\n    throw new Error('Unable to get first navigation entry.');\n  }\n\n  return retrieveFromUrl(navigationEntry.name);\n}\n","import { getStorageValue, setStorageValue } from '@telegram-apps/toolkit';\nimport { serializeLaunchParams } from '@telegram-apps/transformers';\nimport type { LaunchParams } from '@telegram-apps/types';\n\nimport { parseLaunchParams } from './parseLaunchParams.js';\n\nconst STORAGE_KEY = 'launchParams';\n\n/**\n * @returns Launch parameters stored in the session storage.\n * @throws Error if function was unable to extract launch parameters from the window location hash.\n */\nexport function retrieveFromStorage(): LaunchParams {\n  return parseLaunchParams(getStorageValue(STORAGE_KEY) || '');\n}\n\n/**\n * Saves specified launch parameters in the session storage.\n * @param value - launch params to save.\n */\nexport function saveToStorage(value: LaunchParams): void {\n  setStorageValue('launchParams', serializeLaunchParams(value));\n}\n","import type { LaunchParams } from '@telegram-apps/types';\nimport { TypedError } from '@telegram-apps/toolkit';\n\nimport { ERR_RETRIEVE_LP_FAILED } from '@/errors.js';\n\nimport { retrieveFromLocation } from './retrieveFromLocation.js';\nimport { retrieveFromPerformance } from './retrieveFromPerformance.js';\nimport { retrieveFromStorage, saveToStorage } from './storage.js';\n\nfunction unwrapError(e: unknown): string {\n  if (e instanceof Error) {\n    return e.message + (e.cause ? `\\n  ${unwrapError(e.cause)}` : '');\n  }\n  return JSON.stringify(e);\n}\n\n/**\n * @returns Launch parameters from any known source.\n * @throws {TypedError} ERR_RETRIEVE_LP_FAILED\n */\nexport function retrieveLaunchParams(): LaunchParams {\n  const errors: unknown[] = [];\n\n  for (const retrieve of [\n    // Try to retrieve launch parameters from the current location. This method can return\n    // nothing in case, location was changed, and then the page was reloaded.\n    retrieveFromLocation,\n    // Then, try using the lower level API - window.performance.\n    retrieveFromPerformance,\n    // Finally, try to extract launch parameters from the session storage.\n    retrieveFromStorage,\n  ]) {\n    try {\n      const lp = retrieve();\n      saveToStorage(lp);\n      return lp;\n    } catch (e) {\n      errors.push(e);\n    }\n  }\n\n  throw new TypedError(ERR_RETRIEVE_LP_FAILED, [\n    'Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?',\n    '📖 Refer to docs for more information:',\n    'https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment',\n    'Collected errors:',\n    ...errors.map(e => `— ${unwrapError(e)}`),\n  ].join('\\n'));\n}\n","import { CancelablePromise, type AsyncOptions } from '@telegram-apps/toolkit';\n\nimport { request } from '@/utils/request.js';\nimport { hasWebviewProxy } from '@/env/hasWebviewProxy.js';\nimport { retrieveLaunchParams } from '@/launch-params/retrieveLaunchParams.js';\n\n/**\n * Returns true if the current environment is Telegram Mini Apps.\n *\n * It uses the `retrieveLaunchParams` function to determine if the environment contains\n * launch parameters. In case it does, true will be returned.\n *\n * In case you need stricter checks, use async override of this function.\n */\nexport function isTMA(type: 'simple'): boolean;\n\n/**\n * Returns promise with true if the current environment is Telegram Mini Apps.\n *\n * First of all, it checks if the current environment contains traits specific to the\n * Mini Apps environment.\n * Then, it attempts to call a Mini Apps method and waits for a response to be received.\n *\n * In case you need less strict checks, use sync override of this function.\n */\nexport function isTMA(options?: AsyncOptions): CancelablePromise<boolean>\n\nexport function isTMA(optionsOrType?: AsyncOptions | 'simple'): boolean | CancelablePromise<boolean> {\n  if (optionsOrType === 'simple') {\n    try {\n      retrieveLaunchParams();\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  return CancelablePromise.withFn(async () => {\n    if (hasWebviewProxy(window)) {\n      return true;\n    }\n    try {\n      await request('web_app_request_theme', 'theme_changed', { timeout: 100 });\n      return true;\n    } catch {\n      return false;\n    }\n  }, optionsOrType);\n}\n","/**\n * Emits an event sent from the Telegram native application like it was sent in a default web\n * environment between two iframes.\n *\n * It dispatches a new MessageEvent and expects it to be handled via\n * the `window.addEventListener('message', ...)` call, as a developer would do it to handle\n * messages sent from the parent iframe.\n * @param eventType - event name.\n * @param eventData - event payload.\n */\nexport function emitMiniAppsEvent(eventType: string, eventData?: unknown): void {\n  window.dispatchEvent(new MessageEvent('message', {\n    data: JSON.stringify({ eventType, eventData }),\n    // We specify window.parent to imitate the case, the parent iframe sent us this event.\n    source: window.parent,\n  }));\n}","import {\n  miniAppsMessage,\n  serializeThemeParams,\n  type ThemeParams,\n} from '@telegram-apps/transformers';\nimport type { LaunchParams } from '@telegram-apps/types';\n\nimport { parseLaunchParams } from '@/launch-params/parseLaunchParams.js';\nimport { saveToStorage } from '@/launch-params/storage.js';\nimport { logInfo } from '@/debug.js';\nimport { emitMiniAppsEvent } from '@/events/emitMiniAppsEvent.js';\nimport type { EventPayload } from '@/events/types/index.js';\n\n/**\n * Intercepts the window.parent.postMessage call and performs pre-defined actions. For example,\n * it may handle the request theme request and emit the theme_changed event.\n * @param tp - theme params.\n * @param data - postMessage data.\n */\nfunction imitatePostEvent(tp: ThemeParams, data: unknown): void {\n  if (typeof data !== 'string') {\n    return;\n  }\n  try {\n    const { eventType } = miniAppsMessage()(data);\n\n    if (eventType === 'web_app_request_theme') {\n      emitMiniAppsEvent('theme_changed', {\n        theme_params: JSON.parse(serializeThemeParams(tp)),\n      } satisfies EventPayload<'theme_changed'>);\n    }\n\n    if (eventType === 'web_app_request_viewport') {\n      emitMiniAppsEvent('viewport_changed', {\n        width: window.innerWidth,\n        height: window.innerHeight,\n        is_state_stable: true,\n        is_expanded: true,\n      } satisfies EventPayload<'viewport_changed'>);\n    }\n  } catch {\n  }\n}\n\n/**\n * Mocks a Telegram application environment.\n * @param launchParamsRaw - launch parameters presented as a string or query parameters.\n */\nexport function mockTelegramEnv(launchParamsRaw: LaunchParams | string): void {\n  const lp = typeof launchParamsRaw === 'string'\n    ? parseLaunchParams(launchParamsRaw)\n    : launchParamsRaw;\n\n  // Save launch params in the storage, so retrieveLaunchParams will return them.\n  saveToStorage(lp);\n\n  // Define a special port, expected by the postEvent function.\n  const proxyPostEvent = (window as any).TelegramWebviewProxy?.postEvent;\n  (window as any).TelegramWebviewProxy = {\n    postEvent(eventType: string, eventData: string) {\n      imitatePostEvent(lp.themeParams, JSON.stringify({ eventType, eventData }));\n      proxyPostEvent?.(eventType, eventData);\n    },\n  };\n\n  logInfo('Environment was mocked by the mockTelegramEnv function');\n}","import { emitMiniAppsEvent } from '@/events/emitMiniAppsEvent.js';\n\n/**\n * Defines special handlers by known paths, which Telegram recognizes as ports to receive events.\n */\nexport function defineEventHandlers() {\n  // Iterate over each path, where \"receiveEvent\" function should be\n  // defined. This function is called by external environment in case,\n  // it wants to emit some event.\n  [\n    ['TelegramGameProxy_receiveEvent'], // Windows Phone.\n    ['TelegramGameProxy', 'receiveEvent'], // Desktop.\n    ['Telegram', 'WebView', 'receiveEvent'], // Android and iOS.\n  ].forEach((path) => {\n    // Path starts from the \"window\" object.\n    let pointer = window as Record<string, any>;\n\n    path.forEach((item, idx, arr) => {\n      // We are on the last iteration, where function property name is passed.\n      if (idx === arr.length - 1) {\n        pointer[item] = emitMiniAppsEvent;\n        return;\n      }\n\n      if (!(item in pointer)) {\n        pointer[item] = {};\n      }\n      pointer = pointer[item];\n    });\n  });\n}\n","/**\n * Removes global event handlers, used by the package.\n */\nexport function removeEventHandlers(): void {\n  ['TelegramGameProxy_receiveEvent', 'TelegramGameProxy', 'Telegram'].forEach((prop) => {\n    delete window[prop as keyof Window];\n  });\n}","import { signalFor } from '@/events/listening/signalFor.js';\nimport type { EventName } from '@/events/types/events.js';\nimport type { EventListener } from '@/events/listening/types.js';\n\n/**\n * Removes the listener from the specified event.\n * @param event - event to listen.\n * @param listener - event listener to remove.\n * @param once - had this listener to be called only once.\n */\nexport function off<E extends EventName>(\n  event: E,\n  listener: EventListener<E>,\n  once?: boolean,\n): void {\n  signalFor(event).unsub(listener, once);\n}\n","import type { RemoveListenerFn } from '@telegram-apps/signals';\n\nimport { lastEventSignal } from '@/events/listening/lastEvent.js';\nimport type { SubscribeListener } from '@/events/listening/types.js';\n\n/**\n * Subscribes to all events sent from the native Telegram application.\n * @param listener - event listener to bind.\n * @param once - should this listener be called only once.\n * @returns Function to remove bound event listener.\n */\nexport function subscribe(listener: SubscribeListener, once?: boolean): RemoveListenerFn {\n  return lastEventSignal().sub(listener, once);\n}\n","import type { SubscribeListenerFn } from '@telegram-apps/signals';\n\nimport { $lastEvent, LastEvent } from '@/events/listening/lastEvent.js';\n\n/**\n * Remove a subscriber listening to all events sent from the native Telegram application.\n * @param listener - event listener to remove.\n * @param once - had this listener to be called only once.\n * @returns Function to remove bound event listener.\n */\nexport function unsubscribe(\n  listener: SubscribeListenerFn<LastEvent | undefined>,\n  once?: boolean,\n): void {\n  $lastEvent.unsub(listener, once);\n}\n","type CaptureSameReqFn = (payload: { req_id: string }) => boolean;\n\n/**\n * Returns a function which can be used in `request` function `capture` property to capture\n * the event with the same request identifier.\n * @param reqId - request identifier.\n */\nexport function captureSameReq(reqId: string): CaptureSameReqFn {\n  return ({ req_id }) => req_id === reqId;\n}\n","import type { Version } from '@telegram-apps/types';\n\nfunction parts(a: Version): number[] {\n  return a.split('.').map(Number);\n}\n\n/**\n * @param a - first version.\n * @param b - second version.\n * @returns\n * - `1` if the version \"a\" is greater than \"b\".\n * - `0` the version \"a\" is equal to \"b\".\n * - `-1` the version \"a\" is lower than \"b\".\n */\nexport function compareVersions(a: Version, b: Version): number {\n  const aParts = parts(a);\n  const bParts = parts(b);\n  const len = Math.max(aParts.length, bParts.length);\n\n  // Iterate over each part of versions and compare them. In case, part is\n  // missing, assume its value is equal to 0.\n  for (let i = 0; i < len; i += 1) {\n    const aVal = aParts[i] || 0\n    const bVal = bParts[i] || 0;\n\n    if (aVal === bVal) {\n      continue;\n    }\n    return aVal > bVal ? 1 : -1;\n  }\n  return 0;\n}\n","import type { Version } from '@telegram-apps/types';\n\nimport { compareVersions } from '@/utils/compareVersions.js';\nimport type {\n  MethodName,\n  MethodNameWithVersionedParams,\n  MethodVersionedParams,\n} from '@/methods/types/index.js';\n\n/**\n * Returns true if \"a\" version is less than or equal to \"b\" version.\n * @param a\n * @param b\n */\nfunction versionLessOrEqual(a: Version, b: Version): boolean {\n  return compareVersions(a, b) <= 0;\n}\n\n/**\n * Returns true in case, passed parameter in specified method is supported.\n * @param method - method name\n * @param param - method parameter\n * @param inVersion - platform version.\n */\nexport function supports<M extends MethodNameWithVersionedParams>(\n  method: M,\n  param: MethodVersionedParams<M>,\n  inVersion: Version,\n): boolean;\n\n/**\n * Returns true in case, specified method is supported in a passed version.\n * @param method - method name.\n * @param inVersion - platform version.\n */\nexport function supports(method: MethodName, inVersion: Version): boolean;\n\nexport function supports(\n  method: MethodName,\n  paramOrVersion: Version | string,\n  inVersion?: string,\n): boolean {\n  // Method name, parameter, target version.\n  if (typeof inVersion === 'string') {\n    if (method === 'web_app_open_link') {\n      if (paramOrVersion === 'try_instant_view') {\n        return versionLessOrEqual('6.4', inVersion);\n      }\n      if (paramOrVersion === 'try_browser') {\n        return versionLessOrEqual('7.6', inVersion);\n      }\n    }\n\n    if (method === 'web_app_set_header_color') {\n      if (paramOrVersion === 'color') {\n        return versionLessOrEqual('6.9', inVersion);\n      }\n    }\n\n    if (method === 'web_app_close' && paramOrVersion === 'return_back') {\n      return versionLessOrEqual('7.6', inVersion);\n    }\n\n    if (method === 'web_app_setup_main_button' && paramOrVersion === 'has_shine_effect') {\n      return versionLessOrEqual('7.10', inVersion);\n    }\n  }\n\n  switch (method) {\n    case 'web_app_open_tg_link':\n    case 'web_app_open_invoice':\n    case 'web_app_setup_back_button':\n    case 'web_app_set_background_color':\n    case 'web_app_set_header_color':\n    case 'web_app_trigger_haptic_feedback':\n      return versionLessOrEqual('6.1', paramOrVersion);\n    case 'web_app_open_popup':\n      return versionLessOrEqual('6.2', paramOrVersion);\n    case 'web_app_close_scan_qr_popup':\n    case 'web_app_open_scan_qr_popup':\n    case 'web_app_read_text_from_clipboard':\n      return versionLessOrEqual('6.4', paramOrVersion);\n    case 'web_app_switch_inline_query':\n      return versionLessOrEqual('6.7', paramOrVersion);\n    case 'web_app_invoke_custom_method':\n    case 'web_app_request_write_access':\n    case 'web_app_request_phone':\n      return versionLessOrEqual('6.9', paramOrVersion);\n    case 'web_app_setup_settings_button':\n      return versionLessOrEqual('6.10', paramOrVersion);\n    case 'web_app_biometry_get_info':\n    case 'web_app_biometry_open_settings':\n    case 'web_app_biometry_request_access':\n    case 'web_app_biometry_request_auth':\n    case 'web_app_biometry_update_token':\n      return versionLessOrEqual('7.2', paramOrVersion);\n    case 'web_app_setup_swipe_behavior':\n      return versionLessOrEqual('7.7', paramOrVersion);\n    case 'web_app_share_to_story':\n      return versionLessOrEqual('7.8', paramOrVersion);\n    case 'web_app_setup_secondary_button':\n    case 'web_app_set_bottom_bar_color':\n      return versionLessOrEqual('7.10', paramOrVersion);\n    case 'web_app_request_safe_area':\n    case 'web_app_request_content_safe_area':\n    case 'web_app_request_fullscreen':\n    case 'web_app_exit_fullscreen':\n    case 'web_app_set_emoji_status':\n    case 'web_app_request_emoji_status_access':\n      return versionLessOrEqual('8.0', paramOrVersion);\n    default:\n      return [\n        'iframe_ready',\n        'iframe_will_reload',\n        'web_app_close',\n        'web_app_data_send',\n        'web_app_expand',\n        'web_app_open_link',\n        'web_app_ready',\n        'web_app_request_theme',\n        'web_app_request_viewport',\n        'web_app_setup_main_button',\n        'web_app_setup_closing_behavior',\n      ].includes(method);\n  }\n}\n","import { isRecord } from '@telegram-apps/transformers';\nimport { TypedError } from '@telegram-apps/toolkit';\nimport type { Version } from '@telegram-apps/types';\n\nimport { ERR_METHOD_PARAMETER_UNSUPPORTED, ERR_METHOD_UNSUPPORTED } from '@/errors.js';\nimport { supports } from '@/methods/supports.js';\nimport { type PostEventFn, postEvent } from '@/methods/postEvent.js';\nimport type {\n  MethodName,\n  MethodNameWithVersionedParams,\n  MethodVersionedParams,\n} from '@/methods/types/index.js';\n\nexport type OnUnsupportedFn = (\n  data: { version: Version } & (\n    | { method: MethodName }\n    | {\n    [M in MethodNameWithVersionedParams]: {\n      method: M;\n      param: MethodVersionedParams<M>;\n    };\n  }[MethodNameWithVersionedParams]),\n) => void;\n\nexport type CreatePostEventMode = 'strict' | 'non-strict';\n\n/**\n * Creates a function which checks if specified method and parameters are supported.\n *\n * If method or parameters are unsupported, the `onUnsupported` function will be called.\n *\n * If `strict` or `non-strict` value was passed as the second argument, the function\n * will create its own `onUnsupported` function with behavior depending on the value passed.\n *\n * - Passing `strict` will make function to throw a `TypedError` error\n * with `ERR_METHOD_UNSUPPORTED` or `ERR_METHOD_PARAMETER_UNSUPPORTED` type.\n * - Passing `non-strict` will just warn you about something being unsupported.\n *\n * @param version - Telegram Mini Apps version.\n * @param onUnsupportedOrMode - function or strict mode. Default: `strict`\n */\nexport function createPostEvent(\n  version: Version,\n  onUnsupportedOrMode?: OnUnsupportedFn | CreatePostEventMode,\n): PostEventFn {\n  onUnsupportedOrMode ||= 'strict';\n  const onUnsupported: OnUnsupportedFn = typeof onUnsupportedOrMode === 'function'\n    ? onUnsupportedOrMode\n    : data => {\n      const { method, version } = data;\n      let message: string;\n      let error: string;\n\n      if ('param' in data) {\n        message = `Parameter \"${data.param}\" of \"${method}\" method is unsupported in Mini Apps version ${version}`;\n        error = ERR_METHOD_PARAMETER_UNSUPPORTED;\n      } else {\n        message = `Method \"${method}\" is unsupported in Mini Apps version ${version}`;\n        error = ERR_METHOD_UNSUPPORTED;\n      }\n\n      if (onUnsupportedOrMode === 'strict') {\n        throw new TypedError(error, message);\n      }\n      return console.warn(message);\n    };\n\n  return ((method: any, params: any) => {\n    // Firstly, check if a method is supported.\n    if (!supports(method, version)) {\n      return onUnsupported({ version, method });\n    }\n\n    // Method could use parameters, which are supported only in specific versions of Mini Apps.\n    // We are validating only those parameters, which are not backward compatible.\n    if (\n      isRecord(params)\n      && method === 'web_app_set_header_color'\n      && 'color' in params\n      && !supports(method, 'color', version)\n    ) {\n      return onUnsupported({ version, method, param: 'color' });\n    }\n\n    return postEvent(method, params);\n  }) as PostEventFn;\n}\n","import { CancelablePromise, TypedError } from '@telegram-apps/toolkit';\n\nimport { ERR_CUSTOM_METHOD_ERR_RESPONSE } from '@/errors.js';\nimport { captureSameReq } from '@/methods/captureSameReq.js';\nimport type { ExecuteWithOptions } from '@/types.js';\nimport type { CustomMethodName, CustomMethodParams } from '@/methods/types/index.js';\n\nimport { request } from './request.js';\n\n/**\n * Invokes known custom method. Returns method execution result.\n * @param method - method name.\n * @param params - method parameters.\n * @param requestId - request identifier.\n * @param options - additional options.\n * @throws {TypedError} ERR_CUSTOM_METHOD_ERR_RESPONSE\n */\nexport function invokeCustomMethod<M extends CustomMethodName>(\n  method: M,\n  params: CustomMethodParams<M>,\n  requestId: string,\n  options?: ExecuteWithOptions,\n): CancelablePromise<unknown>;\n\n/**\n * Invokes unknown custom method. Returns method execution result.\n * @param method - method name.\n * @param params - method parameters.\n * @param requestId - request identifier.\n * @param options - additional options.\n * @throws {TypedError} ERR_CUSTOM_METHOD_ERR_RESPONSE\n */\nexport function invokeCustomMethod(\n  method: string,\n  params: object,\n  requestId: string,\n  options?: ExecuteWithOptions,\n): CancelablePromise<unknown>;\n\nexport function invokeCustomMethod(\n  method: string,\n  params: object,\n  requestId: string,\n  options?: ExecuteWithOptions,\n): CancelablePromise<unknown> {\n  return request('web_app_invoke_custom_method', 'custom_method_invoked', {\n    ...options || {},\n    params: { method, params, req_id: requestId },\n    capture: captureSameReq(requestId),\n  })\n    .then(({ result, error }) => {\n      if (error) {\n        throw new TypedError(ERR_CUSTOM_METHOD_ERR_RESPONSE, error);\n      }\n      return result;\n    });\n}\n","import type { Signal } from '@telegram-apps/signals';\n\nimport { $eventSignalsCache } from '@/events/listening/signalFor.js';\nimport { $lastEvent, $lastEventCleanup } from '@/events/listening/lastEvent.js';\nimport { $targetOrigin } from '@/methods/$targetOrigin.js';\nimport { $debug } from '@/debug.js';\n\nfunction resetSignal(s: Signal<any>): void {\n  s.unsubAll();\n  s.reset();\n}\n\n/**\n * Resets the package state. Normally, you don't use this function in your application.\n * We are using it only for test purposes.\n */\nexport function resetPackageState() {\n  $lastEventCleanup()?.();\n\n  [\n    ...Object.values($eventSignalsCache()),\n    $eventSignalsCache,\n    $lastEvent,\n    $lastEventCleanup,\n    $targetOrigin,\n    $debug,\n  ].forEach(resetSignal);\n}"],"names":["u","e","h","t","S","w","D","W","d","A","a","c","s","P","i","m","p","E","f","g","U","R","l","N","O","_","C","T","b","y","V","$","j","I","B","webViewProxy","object","fn","hasWebviewProxy","value","isIframe","k","r","x","F","n","o","L","v","Z","J","K","M","z","G","q","H","$debug","signal","logInfo","logError","createLogger","transformers","string","createTransformerGen","number","boolean","defineListeners","onEvent","cleanup","createCbCollector","addEventListener","event","message","miniAppsMessage","eventType","eventData","createTransformer","transformed","cause","$lastEvent","$lastEventCleanup","lastEventSignal","$eventSignalsCache","signalFor","cached","ev","on","listener","once","ERR_METHOD_UNSUPPORTED","ERR_RETRIEVE_LP_FAILED","ERR_METHOD_PARAMETER_UNSUPPORTED","ERR_UNKNOWN_ENV","ERR_CUSTOM_METHOD_ERR_RESPONSE","$targetOrigin","postEvent","external","TypedError","request","method","eventOrEvents","options","capture","addCleanup","CancelablePromise","resolve","payload","parseLaunchParams","launchParams","retrieveFromUrl","urlString","retrieveFromLocation","retrieveFromPerformance","navigationEntry","STORAGE_KEY","retrieveFromStorage","getStorageValue","saveToStorage","setStorageValue","serializeLaunchParams","unwrapError","retrieveLaunchParams","errors","retrieve","lp","isTMA","optionsOrType","emitMiniAppsEvent","imitatePostEvent","tp","data","serializeThemeParams","mockTelegramEnv","launchParamsRaw","proxyPostEvent","_a","defineEventHandlers","path","pointer","item","idx","arr","removeEventHandlers","prop","off","subscribe","unsubscribe","captureSameReq","reqId","req_id","parts","compareVersions","aParts","bParts","len","aVal","bVal","versionLessOrEqual","supports","paramOrVersion","inVersion","createPostEvent","version","onUnsupportedOrMode","onUnsupported","error","params","isRecord","invokeCustomMethod","requestId","result","resetSignal","resetPackageState"],"mappings":"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"}